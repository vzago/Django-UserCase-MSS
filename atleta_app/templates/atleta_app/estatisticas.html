{% extends 'atleta_app/base.html' %}
{% load static %}

{% block title %}EstatÃ­sticas dos Atletas{% endblock %}

{% block extra_head %}
<script src="{% static 'atleta_app/js/chart.js' %}"></script>
<link rel="stylesheet" href="{% static 'atleta_app/css/estatisticas.css' %}">
{% endblock %}

{% block content %}
<div class="stats-container">
    <div class="container">
        <div class="stats-header">
            <h1>ğŸ“Š EstatÃ­sticas dos Atletas</h1>
            <p>AnÃ¡lise detalhada do desempenho e caracterÃ­sticas da equipe</p>
        </div>
        
        {% if estatisticas %}
        <!-- Cards de EstatÃ­sticas Principais -->
        <div class="stats-grid">
            {% include 'atleta_app/partials/stat_card.html' with icon='ğŸ‘¥' title='Total de Atletas' value=estatisticas.total_atletas|default:"0" %}
            {% include 'atleta_app/partials/stat_card.html' with icon='ğŸ‚' title='MÃ©dia de Idade' value=estatisticas.media_idade|floatformat:1|default:"0" unit='anos' %}
            {% include 'atleta_app/partials/stat_card.html' with icon='ğŸ“' title='MÃ©dia de Altura' value=estatisticas.media_altura|floatformat:2|default:"0" unit='m' %}
            {% include 'atleta_app/partials/stat_card.html' with icon='âš–ï¸' title='MÃ©dia de Peso' value=estatisticas.media_peso|floatformat:1|default:"0" unit='kg' %}
            {% include 'atleta_app/partials/stat_card.html' with icon='ğŸ†' title='MÃ¡ximo de Jogos' value=estatisticas.max_jogos|default:"0" %}
            {% include 'atleta_app/partials/stat_card.html' with icon='ğŸ¯' title='MÃ­nimo de Jogos' value=estatisticas.min_jogos|default:"0" %}
        </div>

        <!-- SeÃ§Ã£o de GrÃ¡ficos -->
        <div class="charts-section">
            <div class="charts-grid">
                <!-- GrÃ¡fico de Pizza - DistribuiÃ§Ã£o por Idade -->
                <div class="chart-card">
                    <div class="chart-title">ğŸ“ˆ DistribuiÃ§Ã£o por Faixa EtÃ¡ria</div>
                    <div class="chart-container">
                        <canvas id="idadeChart"></canvas>
                    </div>
                </div>
                
                <!-- GrÃ¡fico de Barras - ComparaÃ§Ã£o de MÃ©tricas -->
                <div class="chart-card">
                    <div class="chart-title">ğŸ“Š ComparaÃ§Ã£o de MÃ©tricas</div>
                    <div class="chart-container">
                        <canvas id="metricasChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- GrÃ¡fico de Linha - EvoluÃ§Ã£o de Jogos -->
            <div class="chart-card">
                <div class="chart-title">ğŸ“ˆ EvoluÃ§Ã£o de Jogos por Atleta</div>
                <div class="chart-container chart-container-large">
                    <canvas id="jogosChart"></canvas>
                </div>
            </div>
        </div>

        <!-- InformaÃ§Ãµes de Performance -->
        <div class="performance-info">
            <h3>ğŸš€ <i class="fas fa-rocket"></i> InformaÃ§Ãµes de Performance</h3>
            <p><strong>Cache:</strong> Estas estatÃ­sticas sÃ£o cacheadas por 15 minutos para melhor performance.</p>
            <p><strong>OtimizaÃ§Ã£o:</strong> As consultas sÃ£o otimizadas com Ã­ndices de banco de dados e agregaÃ§Ãµes SQL.</p>
            <ul>
                <li><strong>Ãndices:</strong> Campos de busca otimizados para consultas rÃ¡pidas</li>
                <li><strong>AgregaÃ§Ãµes:</strong> CÃ¡lculos realizados diretamente no banco de dados</li>
                <li><strong>Cache:</strong> Sistema inteligente de cache para reduzir carga do servidor</li>
                <li><strong>Responsividade:</strong> Interface adaptÃ¡vel para diferentes dispositivos</li>
            </ul>
        </div>
        
        {% else %}
        <div class="performance-info">
            <h3>âš ï¸ <i class="fas fa-exclamation-triangle"></i> Nenhuma estatÃ­stica disponÃ­vel</h3>
            <p>NÃ£o hÃ¡ atletas cadastrados no sistema para gerar estatÃ­sticas.</p>
            <p>Cadastre alguns atletas para comeÃ§ar a visualizar as anÃ¡lises!</p>
        </div>
        {% endif %}
        
        <!-- BotÃµes de NavegaÃ§Ã£o -->
        <div class="navigation-buttons">
            <a href="{% url 'home' %}" class="nav-btn nav-btn-primary">
                <i class="fas fa-home"></i> Voltar ao InÃ­cio
            </a>
            <a href="{% url 'visualizarAtleta' %}" class="nav-btn nav-btn-secondary">
                <i class="fas fa-users"></i> Ver Atletas
            </a>
            <a href="{% url 'cadastrarAtleta' %}" class="nav-btn nav-btn-secondary">
                <i class="fas fa-plus"></i> Cadastrar Atleta
            </a>
        </div>
    </div>
</div>

<script src="{% static 'atleta_app/js/estatisticas.js' %}"></script>
<script>
// InicializaÃ§Ã£o dos grÃ¡ficos com dados do Django
document.addEventListener('DOMContentLoaded', function() {
    const chartData = {
        faixasEtarias: JSON.parse('{{ faixas_etarias_json|escapejs }}'),
        nomesAtletas: JSON.parse('{{ nomes_atletas_json|escapejs }}'),
        totalJogos: JSON.parse('{{ total_jogos_json|escapejs }}'),
        jogosTitular: JSON.parse('{{ jogos_titular_json|escapejs }}'),
        estatisticas: JSON.parse('{{ estatisticas_json|escapejs }}')
    };
    
    initializeCharts(chartData);
});
</script>
{% endblock %} 